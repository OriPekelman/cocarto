<div
  id="<%= dom_id(layer) %>"
  class="layer-container"
  data-controller="layer"
  data-layer-layer-outlet=".layer-container.is-active"
  data-layer-map-outlet=".map_document__container"
  data-layer-add-feature-text-value="<%= t("common.add_geometry.#{layer.geometry_type}") %>"
  data-layer-geometry-type-value="<%= layer.geometry_type %>">
  <header class="layer-header">
    <div class="layer-header__left-description">
      <%= embedded_svg "#{layer.geometry_type}.svg", class: "layer-header__icon", style: "color: #{layer.color}" %>
      <%= render "layers/name", layer: layer %>
    </div>
    <div class="layer-header__right-tools">
      <% if layer.rows.size > 0 %>
        <% bbox = layer.bounding_box %>
        <span
          class="layer-header__action"
          title="<%= t(".center_on_layer") %>"
          data-map-lng-min-param="<%= bbox["geo_lng_min"] %>"
          data-map-lng-max-param="<%= bbox["geo_lng_max"] %>"
          data-map-lat-min-param="<%= bbox["geo_lat_min"] %>"
          data-map-lat-max-param="<%= bbox["geo_lat_max"] %>"
          data-action="click->map#center">
          <%= embedded_svg "frame.svg" %>
        </span>
      <% end %>
      <button
        class="layer-header__chevron chevron"
        title="<%= t(".toggle_layer") %>"
        data-action="layer#toggleTable">
      </button>
    </div>
  </header>

  <div class="layer-table__body">
    <%= render "layers/rows", layer: layer %>

    <footer class="layer-footer">
      <div data-restricted-target="restricted" data-restricted-authorizations="<%= %w[owner editor contributor].to_json %>"> <%# Cf policy(layer).edit? %>
        <%= link_to t("helpers.link.layer.add_point"), new_layer_row_path(layer) if layer.geometry_point? %>
      </div>
      <div class="layer-footer__icon">
        <%= link_to layer, data: {turbo_method: :delete, turbo_confirm: t("common.confirm")}, title: t("helpers.link.layer.delete") do %>
          <%= embedded_svg "delete.svg" %>
        <% end %>
      </div>
      <div class="layer-footer__icon">
        <%= link_to geojson_layer_path(layer), download: "#{layer.name}.geojson", title: t("helpers.link.layer.geojson_export") do %>
          <%= embedded_svg "export.svg" %>
        <% end %>
      </div>
    </footer>
  </div>
</div>
