<%# params: layer %>
<%# renders a full table of editable rows for a layer %>

<table class="layer__data display-when-loaded" data-controller="display-when-loaded">
  <thead class="resizable">
    <tr>
      <% if layer.geometry_territory? %>
        <th class="calculated"></th>
        <th class="calculated"><%= t("common.territory_code") %></th>
      <% elsif layer.geometry_point? %>
        <th class="calculated"><%= t("common.longitude") %></th>
        <th class="calculated"><%= t("common.latitude") %></th>
      <% elsif layer.geometry_line_string? %>
        <th class="calculated"><%= t("common.length") %></th>
      <% elsif layer.geometry_polygon? %>
        <th class="calculated"><%= t("common.area") %></th>
      <% end %>

      <%= render partial: "fields/th", collection: layer.fields, as: :field %>

      <% if policy(layer).update? %>
        <th
          id="delete-column"
          class="row-actions dropdown"
          data-controller="dropdown"
          data-dropdown-placement-value="bottom-end"
          data-dropdown-target="trigger">
          <span data-action="click->dropdown#toggle" class="chevron">
            <button><span>+</span></button>
          </span>
          <div class="dropdown-content" data-dropdown-target="content" role="menu" aria-controls="delete-column">
            <%= render "fields/form", field: Field.new(layer: layer) %>
          </div>
        </th>
      <% else %>
        <th id="delete-column"></th>
      <% end %>
    </tr>
  </thead>
  <tbody id="<%= dom_id(layer, "rows") %>">
  <%= render layer.rows %>
  </tbody>
</table>

<%= render "rows/new", row: Row.new(layer: layer) %>
