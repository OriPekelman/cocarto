<%# variables: @header_mode (:app, :cartouche) %>

<% @header_mode ||= :app %>

<header class="header--container">
  <div class="<%= class_names("header", (@header_mode == :app) ? "header--app" : "header--large") %>">
  <% if @header_mode == :cartouche %>
    <%= image_tag("cartouche_color.svg", class: class_names("header__cartouche")) %>
  <% else %>
    <h1>
      <%= link_to root_path, class: class_names("header__logo", "header__logo--app"), title: t("common.app_title") do %>
        <%= embedded_svg("cocarto_logotype.svg") %>
      <% end %>
    </h1>
  <% end %>
  <div id="flash">
    <%= render "layouts/flash" %>
  </div>
  <div class="header__right">
    <% if current_user %>
      <div class="dropdown" data-controller="dropdown" data-action="click->dropdown#toggle" data-dropdown-target="trigger">
        <button class="button button--large button--text" title="<%= t("common.settings") %>">
          <%= current_user.display_name %>
          <%= embedded_svg "chevron_droite.svg", class: "icon--smaller icon--tinted dropdown__indicator" %>
        </button>
        <div class="dropdown__content" data-dropdown-target="content">
          <div class="card__main-content">
            <%= link_to "Français", url_for(locale: :fr) %>
            <%= link_to "English", url_for(locale: :en) %>
            <%= link_to t(".preferences"), edit_user_registration_url unless current_user.anonymous? %>
          </div>
          <div class="card__footer-content">
            <% if current_user.anonymous? %>
              <%= link_to t(".sign_in"), new_user_session_path, class: "button button--link" %>
              <%= link_to t(".sign_up"), new_user_registration_path, class: "button button--confirm" %>
            <% else %>
              <%= button_to t(".sign_out"), destroy_user_session_path, method: :delete, class: "button button--delete" %>
            <% end %>
          </div>
        </div>
      </div>
    <% else %>
      <%= link_to t(".sign_in"), new_user_session_path, class: "button button--large button--link" %>
      <%= link_to t(".sign_up"), new_user_registration_path, class: "button button--large button--confirm" %>
      <div class="dropdown" data-controller="dropdown">
        <button class="icon-button icon-button--double-bordered icon-button--large icon-button--dimmed" role="button" aria-haspopup="menu" aria-label="<%= t(".change_language") %>" aria-controls="languages-selector" data-action="click->dropdown#toggle" data-dropdown-target="trigger">
          <%= embedded_svg "language-selector.svg", class: "icon--tinted" %>
        </button>
        <div id="languages-selector" class="dropdown__content" data-dropdown-target="content">
          <div class="card__main-content card__main-content--slim">
            <%= link_to "English", url_for(locale: :en) %>
            <%= link_to "Français", url_for(locale: :fr) %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
  </div>
</header>
