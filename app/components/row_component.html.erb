<%# For now view components must be cached at the template level
https://github.com/ViewComponent/view_component/discussions/42#discussioncomment-2822874 %>
<% cache [@row, @row.layer.fields] do %>
  <tr
    id="<%= dom_id(@row) %>"
    class="<%= classes %>"
    data-controller="row"
    data-layer-target="row"
    data-map-target="row"
    data-action="focusin->map#highlight"
    data-row-properties-value="<%= @row.css_properties.to_json %>">

      <%= row_tag_calculated_data %>

      <% @row.fields_values.each do |field, value| %>
        <%= render FieldTdComponent.new(field: field, value: value, form_id: form_id, authorizations: RowPolicy.authorizations(@row)) %>
      <% end %>

    <td id="<%= dom_id(@row, "actions") %>" class="layer-table__td layer-table__td-actions">
      <div class="buttons-bar buttons-bar--tight">
        <%= button_to([@row.layer, @row],
              class: "icon-button icon-button--small",
              method: :delete,
              title: t("layers.layer.delete_row"),
              form: {data: {"turbo-confirm": t("common.confirm")}},
              data: {restricted_target: "restricted", restricted_hidden: true, restricted_authorizations: %w[owner editor].to_json}) do %>
          <%= helpers.embedded_svg("remove_item.svg", class: "icon--small icon--tinted") %>
        <% end %>
        <%= row_tag_form %>
        <button
          class="icon-button icon-button--small"
          title="<%= t("layers.layer.center_on_row") %>"
          data-action="map#center"
          data-map-bounds-param="<%= @row.bounding_box.to_json %>">
          <%= helpers.embedded_svg("center.svg", class: "icon--small icon--tinted") %>
        </button>
      </div>
    </td>
  </tr>
<% end %>
